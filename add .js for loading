// app.js - Fetch data from Google Sheets and populate table/chart

const sheetUrl = 'https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/export?format=csv&gid=0'; // Replace YOUR_SHEET_ID with your actual Google Sheet ID, and gid=0 with your sheet tab ID if needed. Ensure the sheet is published to the web as CSV.

async function loadData() {
  try {
    const response = await fetch(sheetUrl);
    const csvText = await response.text();
    const rows = csvText.split('\n').slice(1); // Skip header row
    const tbody = document.querySelector('.dataTable tbody');
    tbody.innerHTML = ''; // Clear existing rows

    let cumulativeProfit = 0;
    const labels = [];
    const profits = [];

    rows.forEach(row => {
      if (!row.trim()) return; // Skip empty rows
      const [date, tip, odds, stake, outcome, profit] = row.split(',');
      const profitValue = parseFloat(profit) || 0;
      cumulativeProfit += profitValue;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${date}</td>
        <td>${tip}</td>
        <td>${odds}</td>
        <td>${stake}</td>
        <td class="${outcome ? outcome.toLowerCase() : ''}">${outcome}</td>
        <td>${profit}</td>
      `;
      tbody.appendChild(tr);

      labels.push(date);
      profits.push(cumulativeProfit);
    });

    // Render chart if there's data
    if (labels.length > 0) {
      const ctx = document.createElement('canvas');
      document.getElementById('chartContainer').innerHTML = ''; // Clear previous chart
      document.getElementById('chartContainer').appendChild(ctx);
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Cumulative Profit (Units)',
            data: profits,
            borderColor: '#FFD700',
            backgroundColor: 'rgba(255, 215, 0, 0.2)',
            fill: true
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    // Update last updated
    document.getElementById('lastUpdated').textContent = `Last Updated: ${new Date().toLocaleString()}`;
  } catch (error) {
    console.error('Error loading data:', error);
    document.getElementById('lastUpdated').textContent = 'Error loading data - Check console for details';
  }
}

document.addEventListener('DOMContentLoaded', loadData);
