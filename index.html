<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BaselineBrains Profit / Loss</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
  <img src="logo.png" alt="BaselineBrains Logo" class="logo" />
  <h1>BaselineBrains Profit / Loss</h1>

  <p id="lastUpdated"></p>

  <h2>Dashboard</h2>
  <div class="table-container">
    <table class="dataTable">
      <thead id="dashboardHead"></thead>
      <tbody id="dashboardBody"></tbody>
    </table>
  </div>

  <h2>Profit Trend</h2>
  <div class="chart-container">
    <canvas id="profitChart"></canvas>
  </div>

  <h2>Tips Log</h2>
  <div class="table-container">
    <table class="dataTable">
      <thead id="tipsHead"></thead>
      <tbody id="tipsBody"></tbody>
    </table>
  </div>

  <footer>BaselineBrains © 2025 — All Rights Reserved.</footer>

  <script>
    function buildTablePapa(csvUrl, headId, bodyId, isDashboard) {
      Papa.parse(csvUrl, {
        download: true,
        header: false,
        complete: function(results) {
          const rows = results.data;
          const tableHead = document.getElementById(headId);
          const tableBody = document.getElementById(bodyId);

          if (rows.length > 0) {
            let headerRow = '<tr>';
            rows[0].forEach(cell => {
              headerRow += '<th>' + cell + '</th>';
            });
            headerRow += '</tr>';
            tableHead.innerHTML = headerRow;
          }

          let profitData = [];
          let labels = [];

          for (let i = 1; i < rows.length; i++) {
            if (rows[i].every(cell => cell.trim() === "" || cell.trim() === '"')) continue;
            let rowHtml = '<tr>';
            rows[i].forEach((cell, colIndex) => {
              let className = "";
              let icon = "";
              if (colIndex === 5) { 
                if (cell.toLowerCase().includes("win")) { className = "win"; icon = "✅ "; }
                else if (cell.toLowerCase().includes("loss")) { className = "loss"; icon = "❌ "; }
                else if (cell.toLowerCase().includes("void")) { className = "void"; icon = "➖ "; }
              }
              rowHtml += '<td class="' + className + '">' + icon + cell + '</td>';
            });
            rowHtml += '</tr>';
            tableBody.innerHTML += rowHtml;

            if (isDashboard) {
              labels.push(rows[i][0]);
              let profit = parseFloat(rows[i][rows[i].length - 1]);
              profitData.push(profit);
            }
          }

          if (isDashboard) {
            var ctx = document.getElementById('profitChart').getContext('2d');
            new Chart(ctx, {
              type: 'line',
              data: {
                labels: labels,
                datasets: [{
                  label: 'Profit',
                  data: profitData,
                  borderColor: '#FFD700',
                  backgroundColor: 'rgba(255, 215, 0, 0.2)',
                  tension: 0.3,
                  fill: true
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: { display: false }
                }
              }
            });
          }

          document.getElementById('lastUpdated').innerText = 'Last updated: ' + new Date().toLocaleString();
        },
        error: function(err) {
          console.error('PapaParse error:', err);
        }
      });
    }

    buildTablePapa("https://docs.google.com/spreadsheets/d/e/2PACX-1vR1SqB34ONUqDxXRd6w8vc2VqpaumUypOxIuK-4sTQ6zCr6MHFP-2VsICOr5ILqzg/pub?gid=1265439786&single=true&output=csv", "dashboardHead", "dashboardBody", true);
    buildTablePapa("https://docs.google.com/spreadsheets/d/e/2PACX-1vR1SqB34ONUqDxXRd6w8vc2VqpaumUypOxIuK-4sTQ6zCr6MHFP-2VsICOr5ILqzg/pub?gid=1251556089&single=true&output=csv", "tipsHead", "tipsBody", false);
  </script>
</body>
</html>
